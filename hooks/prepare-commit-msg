#!/usr/bin/env python3
"""Inject a glitter-dripping snark footer into commit messages."""

from __future__ import annotations

import os
import random
import sys
from pathlib import Path


def main() -> None:
    if len(sys.argv) < 2:
        return

    msg_file = Path(sys.argv[1])
    commit_source = sys.argv[2] if len(sys.argv) > 2 else None

    # Skip merge commits or squashes where a pre-filled message should remain untouched.
    if commit_source in {"merge", "squash", "commit"}:
        return

    repo_root = Path(__file__).resolve().parents[1]
    sys.path.insert(0, str(repo_root))

    try:
        from snark_messages import SNARKY_MESSAGES
    except Exception as exc:  # pragma: no cover - hook should fail loudly.
        raise SystemExit(f"Unable to load snark messages: {exc}")

    flourish = random.choice(SNARKY_MESSAGES)

    with msg_file.open("a", encoding="utf-8") as handle:
        handle.write("\n\nâœ¨ " + flourish + "\n")


if __name__ == "__main__":
    main()
